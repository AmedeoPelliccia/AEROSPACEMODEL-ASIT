# =============================================================================
# META TRANSFORMATION LAYERS (MTL) — Core Standard
# Standard ID: MTL-META-CORE
# Version: 1.0.0
# =============================================================================
#
# PURPOSE:
#   Define a domain-agnostic, reusable architecture that converts any learnable
#   or tokenizable process into verified, traceable, trainable token layers.
#
# SCOPE:
#   Universal - applies to ATA aerospace, robotics, MRO, certification,
#   PAL (Program Assembly Lines), RTM (Requirements Traceability), and
#   ASI (Artificial Superintelligence) training pipelines.
#
# ALIAS:
#   "Motion Transmission Lever" when the domain is physical / robotic.
#
# COMPLIANCE:
#   S1000D Issue 5.0 (structural alignment)
#   DO-178C / ARP4754A / ARP4761 (safety domains)
#   EU AI Act (AI-specific risk categories)
#
# =============================================================================

# -----------------------------------------------------------------------------
# METADATA
# -----------------------------------------------------------------------------
metadata:
  standard_id: "MTL-META-CORE"
  title: "Meta Transformation Layers Core Standard"
  version: "1.0.0"
  status: "DRAFT"
  classification: "Framework Standard"

  created_date: "2026-02-16"
  effective_date: "2026-02-16"

  author: "ASIT Configuration Management"
  approved_by: ""
  approval_reference: ""

  compliance:
    - "S1000D Issue 5.0"
    - "DO-178C"
    - "ARP4754A"
    - "ARP4761"
    - "EU AI Act"

  determinism_level: "strict"
  audit_required: true
  replay_capable: true

# -----------------------------------------------------------------------------
# DEFINITION
# -----------------------------------------------------------------------------
definition: |
  Meta Transformation Layers (MTL) is a system of semantic stratification
  that converts a process — human, digital, or physical — into:

    1. Domain context representation        (L5)
    2. Structural resolution                (L4)
    3. Composed procedures                  (L3)
    4. Atomic transformation methods        (L2)
    5. Subject / evidence units             (L1)

  Every artifact carries full traceability, governance metadata, and is
  suitable for direct AI model training, so the model learns on the same
  tokens it later consumes in execution.

# -----------------------------------------------------------------------------
# LAYERS
# -----------------------------------------------------------------------------
layers:
  - id: "L5"
    name: "Domain Context Token"
    purpose: "Identify which system or problem is being solved"
    token_pattern: "CTX-{DOMAIN}-{SYS}"
    ata_28_equivalent: "SDR-28 (System Domain Resolver)"
    examples:
      - "CTX-AERO-28"
      - "CTX-ROB-LINE"
      - "CTX-MRO-ENG"

  - id: "L4"
    name: "Structure Resolver Token"
    purpose: "Identify which component or sub-process applies"
    token_pattern: "STR-{DOMAIN}-{SYS}-{COMP}"
    ata_28_equivalent: "SCR-28-{SS} (Section/Component Resolver)"
    examples:
      - "STR-AERO-28-11"
      - "STR-ROB-LINE-ST04"
      - "STR-MRO-ENG-HPT"

  - id: "L3"
    name: "Procedure Composer Token"
    purpose: "End-to-end flow of steps, hand-offs, and gates"
    token_pattern: "PRC-{DOMAIN}-{SYS}-{SEQ}"
    ata_28_equivalent: "STP-28-11-{SEQ} (Standard Token Procedure)"
    examples:
      - "PRC-AERO-28-001"
      - "PRC-ROB-LINE-012"
      - "PRC-MRO-ENG-005"

  - id: "L2"
    name: "Transformation Method Token"
    purpose: "Formulas, rules, models, heuristics — validated atomic methods"
    token_pattern: "XFM-{DOMAIN}-{SYS}-{CLASS}-{SEQ}"
    ata_28_equivalent: "MTP-28-11-{DOM}-{SEQ} (Process/Scaling Method)"
    examples:
      - "XFM-AERO-28-THRM-001"
      - "XFM-ROB-LINE-KIN-003"
      - "XFM-MRO-ENG-MATL-010"

  - id: "L1"
    name: "Subject / Evidence Token"
    purpose: "Facts, criteria, constraints, evidences — atomic knowledge units"
    token_pattern: "SBJ-{DOMAIN}-{SYS}-{CLASS}-{SEQ}"
    ata_28_equivalent: "MTK-28-11-{DOM}-{SEQ} (Subject Token)"
    examples:
      - "SBJ-AERO-28-TS-001"
      - "SBJ-ROB-LINE-QA-014"
      - "SBJ-MRO-ENG-SAFE-003"

# -----------------------------------------------------------------------------
# TOKEN CONTRACT SCHEMA
# -----------------------------------------------------------------------------
token_contract:
  description: |
    Every token, regardless of domain, must include the core required fields.
    Layer-specific fields are mandatory only for the indicated layer.
    This split avoids BREX invalidations on tokens that do not belong to a
    given layer (e.g. method_class is only required for L2).

  # Fields required for ALL tokens (L1–L5)
  core_required_fields:
    - "token_id"
    - "layer"
    - "name"
    - "intent"
    - "inputs"
    - "outputs"
    - "assumptions"
    - "constraints"
    - "acceptance_gates"
    - "governance"
    - "trace"

  # Sub-fields required inside governance object
  governance_required_fields:
    - "owner_role"
    - "status"
    - "version"

  # Sub-fields required inside trace object
  trace_required_fields:
    - "derives_from"
    - "feeds"

  # Fields mandatory ONLY for the specified layer
  layer_specific_fields:
    L5:
      - "domain_scope"
      - "regulatory_basis"
    L4:
      - "resolver_rules"
      - "target_components"
    L3:
      - "procedure_steps"
      - "handoffs"
      - "terminal_outputs"
    L2:
      - "method_class"
      - "equation_or_rule"
      - "validity_range"
    L1:
      - "evidence_type"
      - "source_artifacts"
      - "confidence"

# -----------------------------------------------------------------------------
# METHOD CLASS TAXONOMY (L2)
# -----------------------------------------------------------------------------
method_classes:
  description: |
    Stable taxonomy of L2 transformation-method families.  Models can be
    trained per family and then composed at L3.
  classes:
    - id: "GEOM"
      name: "Geometry / Spatial"
    - id: "KIN"
      name: "Kinematics"
    - id: "DYN"
      name: "Dynamics"
    - id: "THRM"
      name: "Thermal"
    - id: "MATL"
      name: "Materials"
    - id: "CTRL"
      name: "Control"
    - id: "QUAL"
      name: "Quality / Metrology"
    - id: "SAFE"
      name: "Safety"
    - id: "CERT"
      name: "Certification"
    - id: "EVAL"
      name: "Evaluation / Optimization"
    - id: "OPS"
      name: "Operations"
    - id: "MRO"
      name: "Maintenance / Repair"

# -----------------------------------------------------------------------------
# DOMAIN PROFILES
# -----------------------------------------------------------------------------
domain_profiles:
  description: |
    Meta Transformation Layers is the global framework.
    Domain profiles are specializations that inherit and extend it.
  profiles:
    - profile_id: "AERO"
      name: "Aerospace (ATA-aligned)"
      description: "S1000D / ATA chapter-based aerospace systems"
      existing_implementation: "ATA 28-11 5D token architecture"
    - profile_id: "ROB"
      name: "Robotics / Motion Transmission Lever"
      description: "Kinematics, actuators, force/torque transmission, mechatronic MRO"
      alias: "Motion Transmission Lever"
    - profile_id: "MRO"
      name: "Maintenance, Repair, Overhaul"
      description: "Cross-domain maintenance and repair operations"
    - profile_id: "CERT"
      name: "Certification / Compliance"
      description: "Regulatory compliance workflows"
    - profile_id: "PAL"
      name: "Program Assembly Line"
      description: "Software and integration pipeline governance"

# -----------------------------------------------------------------------------
# INVARIANTS
# -----------------------------------------------------------------------------
invariants:
  description: "Global properties that must hold for any MTL deployment"
  rules:
    - id: "INV-001"
      name: "Deterministic Replay"
      statement: "Given token_id + version, execution output is deterministic"
    - id: "INV-002"
      name: "Full Traceability"
      statement: "Every token defines derives_from and feeds references"
    - id: "INV-003"
      name: "Machine-Evaluable Gates"
      statement: "All acceptance_gates can be evaluated without human input"
    - id: "INV-004"
      name: "Model-Token Version Lock"
      statement: "MODEL.token_version == TOKEN_LIBRARY.version"

# -----------------------------------------------------------------------------
# GOVERNANCE POLICIES
# -----------------------------------------------------------------------------
governance:
  policies:
    - id: "GOV-001"
      name: "Hard Version Lock"
      statement: "MODEL.token_version == TOKEN_LIBRARY.version"
      enforcement: "block"
    - id: "GOV-002"
      name: "Deny by Default for Autonomy"
      statement: "No autonomous execution without explicit approval"
      enforcement: "block"
    - id: "GOV-003"
      name: "No Silent Gate Override"
      statement: "Safety/harm-sensitive branches cannot bypass gates"
      enforcement: "escalate"
      escalation_target: "STK_SAF"
    - id: "GOV-004"
      name: "Labor Continuity Constraint"
      statement: "Operational optimisations must not eliminate labor without review"
      enforcement: "escalate"
      escalation_target: "STK_OPS"

# -----------------------------------------------------------------------------
# DECISION STATES
# -----------------------------------------------------------------------------
decision_states:
  description: |
    All policy and gate evaluations resolve to one deterministic state.
    No safety-relevant flow may transition directly to ALLOW after a failed
    mandatory gate.
  allowed_states:
    - "ALLOW"
    - "HOLD"
    - "REJECT"
    - "ESCALATE"
  transition_rules:
    - when: "policy_enforcement == BLOCK and condition_fail == true"
      then: "REJECT"
    - when: "policy_enforcement == ESCALATE and condition_fail == true"
      then: "ESCALATE"
    - when: "gate_boundary == uncertain"
      then: "HOLD"
    - when: "all_required_gates_pass == true"
      then: "ALLOW"

# -----------------------------------------------------------------------------
# CANONICAL LEARNING RULE
# -----------------------------------------------------------------------------
learning_rule:
  statement: |
    The model learns on the same tokens it later consumes in execution.
  benefits:
    - "Zero semantic drift between training and deployment"
    - "Deterministic replay by token + version"
    - "Complete decision traceability"
    - "Automatic evidence for audit and certification"

# -----------------------------------------------------------------------------
# COMPATIBILITY
# -----------------------------------------------------------------------------
compatibility:
  ata_28_mapping:
    description: "Backward-compatible mapping to existing ATA 28-11 5D tokens"
    layer_map:
      L5: "D5 / SDR-{ATA}"
      L4: "D4 / SCR-{ATA}-{SS}"
      L3: "D3 / STP-{ATA}-{SS}-{SEQ}"
      L2: "D2 / MTP-{ATA}-{SS}-{DOM}-{SEQ}"
      L1: "D1 / MTK-{ATA}-{SS}-{DOM}-{SEQ}"

  backward_mapping_rules:
    description: |
      Regex rules for transforming legacy ATA 28-11 token IDs into
      universal MTL token IDs without ambiguity.
    rules:
      - from_regex: "^SDR-(\\d{2})$"
        to_pattern: "CTX-AERO-{1}"
      - from_regex: "^SCR-(\\d{2})-(\\d{2})$"
        to_pattern: "STR-AERO-{1}-{2}"
      - from_regex: "^STP-(\\d{2})-(\\d{2})-(\\d{3})$"
        to_pattern: "PRC-AERO-{1}{2}-{3}"
      - from_regex: "^MTP-(\\d{2})-(\\d{2})-([A-Z]{4})-(\\d{3})$"
        to_pattern: "XFM-AERO-{1}{2}-{3}-{4}"
      - from_regex: "^MTK-(\\d{2})-(\\d{2})-([A-Z]{2})-(\\d{3})$"
        to_pattern: "SBJ-AERO-{1}{2}-{3}-{4}"

# -----------------------------------------------------------------------------
# SUMMARY
# -----------------------------------------------------------------------------
summary:
  total_layers: 5
  total_method_classes: 12
  total_invariants: 4
  total_governance_policies: 4
  total_domain_profiles: 5
  total_decision_states: 4
  total_backward_mapping_rules: 5
