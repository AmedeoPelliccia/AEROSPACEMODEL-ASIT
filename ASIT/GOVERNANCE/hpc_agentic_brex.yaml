# =============================================================================
# HPC AGENTIC BREX RULES
# Business Rules Exchange for HPC + Quantum + Multi-Agent Systems
# =============================================================================
#
# This file defines BREX decision rules specifically for:
#   - HPC job scheduling and execution
#   - Multi-agent MDO swarm operations
#   - Quantum-accelerated optimization
#   - Hybrid classical-quantum workflows
#
# All agentic operations MUST pass through these BREX rules to ensure:
#   - Deterministic, auditable behavior
#   - No unconstrained AI freedom
#   - Full traceability for certification
#   - Safety compliance
#
# Authority: ASIT
# Version: 2.0.0
# =============================================================================

metadata:
  brex_id: "HPC-AGENTIC-BREX-001"
  title: "HPC Agentic BREX Rules"
  version: "2.0.0"
  status: "NORMATIVE"
  
  authority: "ASIT"
  effective_date: "2026-01-01"
  
  compliance:
    - "S1000D Issue 5.0"
    - "DO-178C Level A"
    - "ARP4754A DAL A"
  
  scope:
    - "HPC job scheduling"
    - "Multi-agent MDO operations"
    - "Quantum optimization"
    - "Hybrid workflows"

# =============================================================================
# HPC CONTRACT AND BASELINE RULES
# =============================================================================

hpc_contract_rules:
  # HPC-CTR-001: Contract Required for HPC Execution
  - rule_id: "HPC-CTR-001"
    name: "HPC Contract Required"
    description: |
      All HPC job submissions MUST be associated with an approved ASIT contract.
      HPC resources cannot be consumed without contract authorization.
    conditions:
      - condition_type: "contract_required"
        parameter: "contract_id"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "critical"
    message: "HPC job requires approved ASIT contract"
    
  # HPC-CTR-002: Contract Resource Limits
  - rule_id: "HPC-CTR-002"
    name: "Contract Resource Limits"
    description: |
      HPC resource requests must be within contract-defined limits.
    conditions:
      - condition_type: "custom"
        parameter: "resource_request"
        custom_validator: "validate_within_contract_limits"
    action_if_true: "allow"
    action_if_false: "escalate"
    escalation_target: "HPC_ADMIN"
    severity: "error"
    message: "Resource request exceeds contract limits"

  # HPC-BL-001: Baseline Required
  - rule_id: "HPC-BL-001"
    name: "Baseline Required for HPC"
    description: |
      HPC jobs must reference an established baseline.
    conditions:
      - condition_type: "baseline_required"
        parameter: "baseline_id"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "critical"
    message: "HPC job requires established baseline"

# =============================================================================
# HPC JOB EXECUTION RULES
# =============================================================================

hpc_execution_rules:
  # HPC-EXEC-001: Job Priority Assignment
  - rule_id: "HPC-EXEC-001"
    name: "Job Priority Assignment"
    description: |
      Job priority must be assigned based on safety criticality and contract terms.
    conditions:
      - condition_type: "custom"
        parameter: "priority"
        custom_validator: "validate_priority_assignment"
    action_if_true: "allow"
    action_if_false: "warn"
    severity: "warning"
    message: "Job priority assignment validation"

  # HPC-EXEC-002: Resource Allocation Validation
  - rule_id: "HPC-EXEC-002"
    name: "Resource Allocation Validation"
    description: |
      Resource allocation must not exceed available capacity.
    conditions:
      - condition_type: "custom"
        parameter: "resource_allocation"
        custom_validator: "validate_resource_availability"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "Insufficient resources for job execution"

  # HPC-EXEC-003: Safety Critical Job Handling
  - rule_id: "HPC-EXEC-003"
    name: "Safety Critical Job Handling"
    description: |
      Safety-critical HPC jobs require elevated handling and validation.
    conditions:
      - condition_type: "safety_impact"
        parameter: "safety_critical"
    action_if_true: "escalate"
    action_if_false: "allow"
    escalation_target: "STK_SAF"
    severity: "critical"
    message: "Safety-critical HPC job requires elevated handling"

# =============================================================================
# WORKLOAD-SPECIFIC RULES
# =============================================================================

workload_rules:
  # HPC-CFD-001: CFD Simulation Authorization
  - rule_id: "HPC-CFD-001"
    name: "CFD Simulation Authorization"
    description: |
      CFD simulations require authorization and appropriate mesh validation.
    conditions:
      - condition_type: "custom"
        parameter: "cfd_config"
        custom_validator: "validate_cfd_configuration"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "CFD configuration validation failed"
    ata_domains: ["ATA 27", "ATA 57"]

  # HPC-FEM-001: FEM Analysis Authorization
  - rule_id: "HPC-FEM-001"
    name: "FEM Analysis Authorization"
    description: |
      FEM analyses require structural model validation.
    conditions:
      - condition_type: "custom"
        parameter: "fem_config"
        custom_validator: "validate_fem_configuration"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "FEM configuration validation failed"
    ata_domains: ["ATA 51", "ATA 53", "ATA 55", "ATA 57"]

  # HPC-PROP-001: Propulsion Analysis Authorization
  - rule_id: "HPC-PROP-001"
    name: "Propulsion Analysis Authorization"
    description: |
      Propulsion analyses require engine model validation.
    conditions:
      - condition_type: "custom"
        parameter: "propulsion_config"
        custom_validator: "validate_propulsion_configuration"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "Propulsion configuration validation failed"
    ata_domains: ["ATA 71", "ATA 72", "ATA 73"]

# =============================================================================
# MULTI-AGENT MDO RULES
# =============================================================================

mdo_agent_rules:
  # MDO-SWARM-001: Agent Swarm Initialization
  - rule_id: "MDO-SWARM-001"
    name: "Agent Swarm Initialization"
    description: |
      MDO agent swarms require contract authorization and bounded design space.
    conditions:
      - condition_type: "contract_required"
        parameter: "swarm_contract_id"
      - condition_type: "custom"
        parameter: "design_space"
        custom_validator: "validate_design_space_bounded"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "critical"
    message: "MDO swarm initialization requires valid contract and bounded design space"

  # MDO-AGENT-001: Agent Decision Authorization
  - rule_id: "MDO-AGENT-001"
    name: "Agent Decision Authorization"
    description: |
      All agent decisions must be logged and within permitted decision boundaries.
    conditions:
      - condition_type: "custom"
        parameter: "agent_decision"
        custom_validator: "validate_agent_decision_bounded"
    action_if_true: "allow"
    action_if_false: "escalate"
    escalation_target: "MDO_ORCHESTRATOR"
    severity: "error"
    message: "Agent decision outside permitted boundaries"

  # MDO-AERO-001: Aerodynamics Agent Constraints
  - rule_id: "MDO-AERO-001"
    name: "Aerodynamics Agent Constraints"
    description: |
      Aerodynamics agent must operate within physical and regulatory constraints.
    conditions:
      - condition_type: "custom"
        parameter: "aero_modifications"
        custom_validator: "validate_aero_physical_bounds"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "Aerodynamic modification outside physical bounds"

  # MDO-STRUCT-001: Structures Agent Constraints
  - rule_id: "MDO-STRUCT-001"
    name: "Structures Agent Constraints"
    description: |
      Structures agent must ensure safety margins are maintained.
    conditions:
      - condition_type: "custom"
        parameter: "structural_modifications"
        custom_validator: "validate_structural_safety_margin"
    action_if_true: "allow"
    action_if_false: "escalate"
    escalation_target: "STK_SAF"
    severity: "critical"
    message: "Structural modification may violate safety margins"

  # MDO-PROP-001: Propulsion Agent Constraints
  - rule_id: "MDO-PROP-001"
    name: "Propulsion Agent Constraints"
    description: |
      Propulsion agent must operate within certified engine envelope.
    conditions:
      - condition_type: "custom"
        parameter: "propulsion_modifications"
        custom_validator: "validate_engine_envelope"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "Propulsion modification outside certified envelope"

  # MDO-POP-001: Population Generation Constraints
  - rule_id: "MDO-POP-001"
    name: "Population Generation Constraints"
    description: |
      Design population must be generated within contracted design space.
    conditions:
      - condition_type: "custom"
        parameter: "population"
        custom_validator: "validate_population_in_design_space"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "Generated designs outside contracted design space"

  # MDO-PARETO-001: Pareto Front Validation
  - rule_id: "MDO-PARETO-001"
    name: "Pareto Front Validation"
    description: |
      Pareto front must contain only feasible, constraint-satisfying designs.
    conditions:
      - condition_type: "custom"
        parameter: "pareto_front"
        custom_validator: "validate_pareto_feasibility"
    action_if_true: "allow"
    action_if_false: "warn"
    severity: "warning"
    message: "Pareto front contains infeasible designs"

# =============================================================================
# QUANTUM OPTIMIZATION RULES
# =============================================================================

quantum_rules:
  # HPC-QUANTUM-001: Quantum Resource Authorization
  - rule_id: "HPC-QUANTUM-001"
    name: "Quantum Resource Authorization"
    description: |
      Quantum processor access requires specific authorization.
    conditions:
      - condition_type: "custom"
        parameter: "quantum_request"
        custom_validator: "validate_quantum_authorization"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "critical"
    message: "Quantum processor access requires authorization"

  # MDO-QUANTUM-001: Quantum Problem Formulation
  - rule_id: "MDO-QUANTUM-001"
    name: "Quantum Problem Formulation"
    description: |
      QUBO/Ising formulations must be validated before quantum execution.
    conditions:
      - condition_type: "custom"
        parameter: "qubo_problem"
        custom_validator: "validate_qubo_formulation"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "QUBO problem formulation invalid"

  # QUANTUM-SAFETY-001: Quantum Safety Validation
  - rule_id: "QUANTUM-SAFETY-001"
    name: "Quantum Safety Validation"
    description: |
      Safety-critical decisions cannot rely solely on quantum results without
      classical verification.
    conditions:
      - condition_type: "custom"
        parameter: "quantum_safety_check"
        custom_validator: "validate_quantum_result_verified"
    action_if_true: "allow"
    action_if_false: "escalate"
    escalation_target: "STK_SAF"
    severity: "critical"
    message: "Quantum results for safety-critical decisions require classical verification"

  # QUANTUM-RESULT-001: Quantum Result Quality
  - rule_id: "QUANTUM-RESULT-001"
    name: "Quantum Result Quality"
    description: |
      Quantum optimization results must meet quality thresholds.
    conditions:
      - condition_type: "custom"
        parameter: "quantum_result"
        custom_validator: "validate_quantum_result_quality"
    action_if_true: "allow"
    action_if_false: "warn"
    severity: "warning"
    message: "Quantum result quality below threshold"
    quality_thresholds:
      approximation_ratio_min: 0.7
      shot_count_min: 1000
      error_rate_max: 0.05

# =============================================================================
# ATA DOMAIN RULES
# =============================================================================

ata_domain_rules:
  # HPC-ATA-001: ATA Domain Validation
  - rule_id: "HPC-ATA-001"
    name: "ATA Domain Validation"
    description: |
      HPC workloads must be associated with valid ATA domains.
    conditions:
      - condition_type: "ata_domain_valid"
        parameter: "ata_domain"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "Invalid or missing ATA domain"

  # HPC-ATA-002: ATA Cross-Domain Coupling
  - rule_id: "HPC-ATA-002"
    name: "ATA Cross-Domain Coupling"
    description: |
      Cross-ATA-domain analyses require appropriate coupling validation.
    conditions:
      - condition_type: "custom"
        parameter: "coupled_domains"
        custom_validator: "validate_ata_coupling"
    action_if_true: "allow"
    action_if_false: "warn"
    severity: "warning"
    message: "Cross-domain coupling requires validation"

# =============================================================================
# SYNTHESIS AND REPORTING RULES
# =============================================================================

synthesis_rules:
  # HPC-SYN-001: Results Synthesis Authorization
  - rule_id: "HPC-SYN-001"
    name: "Results Synthesis Authorization"
    description: |
      Results synthesis requires all input analyses to be complete and validated.
    conditions:
      - condition_type: "custom"
        parameter: "synthesis_inputs"
        custom_validator: "validate_synthesis_inputs_complete"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "Synthesis inputs incomplete or not validated"

  # MDO-REPORT-001: MDO Report Generation
  - rule_id: "MDO-REPORT-001"
    name: "MDO Report Generation"
    description: |
      MDO reports must include complete traceability and BREX compliance summary.
    conditions:
      - condition_type: "custom"
        parameter: "report_contents"
        custom_validator: "validate_report_completeness"
    action_if_true: "allow"
    action_if_false: "warn"
    severity: "warning"
    message: "MDO report missing required sections"

# =============================================================================
# WORKFLOW ORCHESTRATION RULES
# =============================================================================

workflow_rules:
  # HPC-WF-001: Workflow Dependency Resolution
  - rule_id: "HPC-WF-001"
    name: "Workflow Dependency Resolution"
    description: |
      Workflow stages can only execute when all dependencies are satisfied.
    conditions:
      - condition_type: "custom"
        parameter: "stage_dependencies"
        custom_validator: "validate_dependencies_complete"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "error"
    message: "Stage dependencies not satisfied"

  # HPC-WF-002: Workflow Convergence Check
  - rule_id: "HPC-WF-002"
    name: "Workflow Convergence Check"
    description: |
      Iterative workflows must check convergence before termination.
    conditions:
      - condition_type: "custom"
        parameter: "convergence_status"
        custom_validator: "validate_convergence"
    action_if_true: "allow"
    action_if_false: "warn"
    severity: "warning"
    message: "Workflow terminated without convergence"

  # HPC-WF-003: Maximum Iteration Guard
  - rule_id: "HPC-WF-003"
    name: "Maximum Iteration Guard"
    description: |
      Iterative workflows must respect maximum iteration limits.
    conditions:
      - condition_type: "custom"
        parameter: "iteration_count"
        custom_validator: "validate_within_max_iterations"
    action_if_true: "allow"
    action_if_false: "escalate"
    escalation_target: "HPC_ADMIN"
    severity: "error"
    message: "Maximum iterations exceeded"

# =============================================================================
# TRACEABILITY RULES
# =============================================================================

traceability_rules:
  # HPC-TRACE-001: Decision Logging
  - rule_id: "HPC-TRACE-001"
    name: "Decision Logging"
    description: |
      All HPC and agent decisions must be logged for audit.
    conditions:
      - condition_type: "custom"
        parameter: "decision_logged"
        custom_validator: "validate_decision_logged"
    action_if_true: "allow"
    action_if_false: "block"
    severity: "critical"
    message: "Decision must be logged before execution"

  # HPC-TRACE-002: Input-Output Trace
  - rule_id: "HPC-TRACE-002"
    name: "Input-Output Trace"
    description: |
      All job inputs and outputs must be traceable.
    conditions:
      - condition_type: "trace_complete"
        parameter: "trace_coverage"
        expected_value: 100
    action_if_true: "allow"
    action_if_false: "warn"
    severity: "warning"
    message: "Incomplete input-output traceability"

# =============================================================================
# ESCALATION TARGETS
# =============================================================================

escalation_targets:
  HPC_ADMIN:
    name: "HPC Administrator"
    description: "Manages HPC cluster resources and policies"
    escalation_conditions:
      - "Resource limit exceeded"
      - "Maximum iterations exceeded"
      
  MDO_ORCHESTRATOR:
    name: "MDO Orchestrator"
    description: "Coordinates multi-agent swarm operations"
    escalation_conditions:
      - "Agent decision out of bounds"
      - "Swarm convergence issues"
      
  STK_SAF:
    name: "Safety Engineer"
    description: "Reviews safety-critical operations"
    escalation_conditions:
      - "Safety-critical job"
      - "Structural safety margin"
      - "Quantum safety verification"

# =============================================================================
# DETERMINISM GUARANTEE
# =============================================================================

determinism_guarantee:
  statement: |
    The HPC Agentic BREX rules ensure:
      - All agent decisions are bounded and deterministic
      - No unconstrained AI freedom in design exploration
      - Full traceability of every decision for certification
      - Quantum results verified by classical methods for safety
      
  properties:
    reproducible: true
    deterministic: true
    auditable: true
    certifiable: true
